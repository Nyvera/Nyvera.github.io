<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrisimAI</title>
<style>
  body {margin:0;height:100vh;display:flex;justify-content:center;align-items:center;font-family:sans-serif;background:linear-gradient(135deg,#dfe9f3,#ffffff);}
  .glass{width:90%;max-width:600px;height:80%;display:flex;flex-direction:column;backdrop-filter:blur(20px) saturate(180%);background-color:rgba(255,255,255,0.25);border-radius:20px;border:1px solid rgba(255,255,255,0.3);box-shadow:0 8px 32px rgba(0,0,0,0.2);padding:20px;}
  h1{text-align:center;color:#333;margin:0 0 15px;font-weight:700;}
  #chat{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:10px;}
  .msg{padding:12px 16px;border-radius:14px;max-width:75%;word-wrap:break-word;font-size:15px;}
  .user{align-self:flex-end;background:rgba(255,255,255,0.6);color:#111;border:1px solid rgba(0,0,0,0.05);}
  .ai{align-self:flex-start;background:rgba(255,255,255,0.4);color:#111;border:1px solid rgba(0,0,0,0.1);}
  form{display:flex;gap:10px;margin-top:10px;}
  input{flex:1;padding:12px;border-radius:12px;border:none;outline:none;font-size:15px;background:rgba(255,255,255,0.6);box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);}
  button{padding:12px 18px;border-radius:12px;border:none;cursor:pointer;background:rgba(255,255,255,0.8);font-weight:600;transition:all 0.2s ease;}
  button:hover{background:rgba(255,255,255,1);transform:scale(1.05);}
</style>
</head>
<body>
<div class="glass">
  <h1>PrisimAI</h1>
  <div id="chat"></div>
  <form id="chat-form">
    <input type="text" id="input" placeholder="Type a message..." required/>
    <button type="submit">Send</button>
  </form>
</div>
<script>
const API_URL = "https://api.mistral.ai/v1/agents/completions";
const API_KEY = "Uhk3m4xQ1m3MeyJD8G2hUXV9CUPia9AE";
const AGENT_ID = "ag:00a239e3:20250918:prisimai:1e918d1e";

const chat = document.getElementById("chat");
const form = document.getElementById("chat-form");
const input = document.getElementById("input");

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = "msg " + role;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage(text) {
  addMessage("user", text);
  input.value = "";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Authorization": "Bearer " + API_KEY,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        agent_id: AGENT_ID,
        messages: [{ role: "user", content: text }],
        max_tokens: 512,
        n: 1,
        stream: false
      })
    });

    if (!res.ok) {
      const err = await res.text();
      addMessage("ai", `Error ${res.status}: ${err}`);
      return;
    }

    const data = await res.json();
    // Mistral returns an array of completions under data.choices
    let reply = "";
    if (data.choices && data.choices.length && data.choices[0].message) {
      reply = data.choices[0].message.content;
    } else if (data.output) {
      reply = data.output;
    } else {
      reply = JSON.stringify(data);
    }

    addMessage("ai", reply);
  } catch (err) {
    addMessage("ai", "Error: " + err.message);
  }
}

form.addEventListener("submit", e => {
  e.preventDefault();
  const text = input.value.trim();
  if (text) sendMessage(text);
});
</script>
</body>
</html>
