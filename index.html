<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nyvera</title>
<style>
:root{
  --accent:#7c3aed;
  --text:#e6eef8;
  --glass-base:rgba(255,255,255,0.06);
  --glass-border:rgba(255,255,255,0.15);
  --user-bg:rgba(124,58,237,0.2);
  --ai-bg:rgba(15,23,36,0.5);
}

*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;font-family:Inter,sans-serif;color:var(--text);overflow:hidden;background:#0b0c1a;}

body{position:relative;}
canvas{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;}

.wrap{
  position:relative;
  z-index:1;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}

/* Sleek liquid glass card */
.card{
  width:90%;
  max-width:600px;
  padding:24px;
  border-radius:40px;
  background:var(--glass-base);
  border:1px solid var(--glass-border);
  backdrop-filter:blur(25px) saturate(180%);
  -webkit-backdrop-filter:blur(25px) saturate(180%);
  box-shadow:0 8px 32px rgba(0,0,0,0.35);
  display:flex;
  flex-direction:column;
  gap:14px;
  position:relative;
  overflow:hidden;
}
.card > *{position:relative;z-index:1;}

textarea{
  width:100%;
  padding:14px;
  border-radius:30px;
  border:none;
  background:rgba(255,255,255,0.08);
  color:var(--text);
  font-size:15px;
  backdrop-filter:blur(18px) saturate(150%);
  outline:none;
  resize:none;
}
button{
  padding:10px 18px;
  border-radius:28px;
  border:none;
  background:linear-gradient(135deg,var(--accent),#60a5fa);
  color:white;
  font-weight:500;
  cursor:pointer;
  transition:0.25s;
}
button:hover{
  transform:scale(1.03);
  box-shadow:0 0 15px rgba(124,58,237,0.6);
}
.chat{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
  max-height:380px;
  overflow-y:auto;
}
.msg{
  padding:12px 16px;
  border-radius:28px;
  backdrop-filter:blur(18px) saturate(160%);
  -webkit-backdrop-filter:blur(18px) saturate(160%);
  box-shadow:0 4px 20px rgba(0,0,0,0.3);
  max-width:75%;
  word-break:break-word;
}
.msg.user{align-self:flex-end;background:var(--user-bg);}
.msg.ai{align-self:flex-start;background:var(--ai-bg);}

/* Cursor liquid orb */
.cursor-follower{
  position:fixed;
  top:0;left:0;
  width:28px;height:28px;
  border-radius:50%;
  pointer-events:none;
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(10px);
  box-shadow:0 0 15px rgba(255,255,255,0.5);
  transform:translate(-50%,-50%);
  z-index:9999;
  animation:pulse 1.2s infinite alternate;
}
@keyframes pulse{
  0%{transform:translate(-50%,-50%) scale(1);}
  100%{transform:translate(-50%,-50%) scale(1.25);}
}

@media (max-width:600px){
  .card{padding:18px;border-radius:32px;}
  textarea{padding:12px;}
}
</style>
</head>
<body>
<canvas id="stars"></canvas>
<div class="cursor-follower"></div>

<div class="wrap">
  <div class="card">
    <div class="chat" id="chat"></div>
    <textarea id="prompt" placeholder="Type a message..."></textarea>
    <button id="sendBtn">Send</button>
    <select id="modelSelect" style="margin-top:10px;"></select>
  </div>
</div>

<script type="module">
import * as webllm from "https://esm.run/@mlc-ai/web-llm";
const { CreateMLCEngine, prebuiltAppConfig } = webllm;

const chatEl=document.getElementById("chat");
const promptEl=document.getElementById("prompt");
const sendBtn=document.getElementById("sendBtn");
const modelSelect=document.getElementById("modelSelect");

let engine=null,messagesHistory=[];

// Populate models
if(prebuiltAppConfig?.model_list){
  prebuiltAppConfig.model_list.forEach(m=>{
    const opt=document.createElement("option");
    opt.value=m.model_id||m.model||m.name;
    opt.text=m.short_name||m.name||m.model_id||m.model;
    modelSelect.appendChild(opt);
  });
}

async function loadEngine(modelId){
  engine = await CreateMLCEngine(modelId,{appConfig:prebuiltAppConfig});
}

modelSelect.addEventListener("change",e=>loadEngine(e.target.value));

function appendMessage(role,text){
  const div=document.createElement("div");
  div.className="msg "+role;
  div.innerText=text;
  chatEl.appendChild(div);
  chatEl.scrollTop=chatEl.scrollHeight;
}

async function sendMessage(){
  const text=promptEl.value.trim();
  if(!text||!engine) return;
  appendMessage("user",text);
  messagesHistory.push({role:"user",content:text});
  promptEl.value="";
  const aiDiv=document.createElement("div"); aiDiv.className="msg ai"; aiDiv.innerText="...";
  chatEl.appendChild(aiDiv); chatEl.scrollTop=chatEl.scrollHeight;
  try{
    let partial="";
    const stream = await engine.chat.completions.create({messages:messagesHistory,temperature:0.7,stream:true});
    for await(const chunk of stream){
      const delta=chunk?.choices?.[0]?.delta?.content||"";
      if(delta){partial+=delta; aiDiv.innerText=partial;}
    }
    messagesHistory.push({role:"assistant",content:partial});
  }catch(err){aiDiv.innerText="Error: "+(err?.message||err);}
}

sendBtn.addEventListener("click",sendMessage);
promptEl.addEventListener("keydown",e=>{if(e.key==="Enter"&&(e.ctrlKey||e.metaKey)) sendMessage();});
</script>

<script>
// Starfield
const canvas=document.getElementById("stars"),ctx=canvas.getContext("2d");
let w,h;
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();
class Particle{constructor(){this.reset();}
reset(){this.x=Math.random()*w;this.y=Math.random()*h;this.r=Math.random()*1.5+0.3;this.dx=(Math.random()-0.5)*0.3;this.dy=(Math.random()-0.5)*0.3;this.alpha=Math.random()*0.5+0.5;}
update(){this.x+=this.dx;this.y+=this.dy;if(this.x<0||this.x>w||this.y<0||this.y>h)this.reset();this.alpha+=(Math.random()-0.5)*0.03;if(this.alpha<0.2)this.alpha=0.2;if(this.alpha>1)this.alpha=1;}
draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fillStyle=`rgba(255,255,255,${this.alpha})`;ctx.fill();}}
const particles=[];for(let i=0;i<150;i++)particles.push(new Particle());
function animate(){ctx.clearRect(0,0,w,h);particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);}
animate();

// Cursor follow
const follower=document.querySelector('.cursor-follower');
const mouse={x:w/2,y:h/2};
window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});
function moveFollower(){follower.style.transform=`translate(${mouse.x}px,${mouse.y}px)`;requestAnimationFrame(moveFollower);}
moveFollower();
</script>
</body>
</html>
